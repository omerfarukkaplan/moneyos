<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="ai.js"></script>
  <style>
    body{background:#0f1115;color:white;font-family:system-ui;padding:40px;}
    .card{background:#1a1f2b;padding:20px;border-radius:16px;margin-bottom:20px;}
    button{background:#00F5D4;border:none;padding:10px 15px;border-radius:8px;}
  </style>
</head>
<body>

<h1>Revenue Dashboard</h1>

<div class="card">
  <h3>Revenue Overview</h3>
  <p id="stats"></p>
</div>

<div class="card">
  <h3>Add Lead</h3>
  <input id="lead_name" placeholder="Lead Name"/>
  <input id="platform" placeholder="Platform"/>
  <textarea id="message"></textarea>
  <button onclick="addLead()">Add</button>
</div>

<div class="card">
  <h3>AI Growth Plan</h3>
  <button onclick="generateGrowthPlan()">Generate</button>
  <div id="growthOutput"></div>
</div>

<script>
const supabase = supabase.createClient(
 "https://ugjydppmolsxlkohhlkm.supabase.co",
 "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVnanlkcHBtb2xzeGxrb2hobGttIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNTk0MDksImV4cCI6MjA4NjgzNTQwOX0.4DjiNkm2WCErx19wzFvtIA7zL8AFSFXmyugcZGK3KyM"
)

async function addLead(){
 const user = await supabase.auth.getUser()
 await supabase.from("leads").insert({
   user_id:user.data.user.id,
   lead_name:lead_name.value,
   platform:platform.value,
   message:message.value
 })
 alert("Lead added")
}

async function loadStats(){
 const user = await supabase.auth.getUser()
 const {data} = await supabase.from("leads")
   .select("*")
   .eq("user_id",user.data.user.id)

 let avg = 0
 if(data.length>0){
   avg = data.reduce((a,b)=>a+(b.intent_score||0),0)/data.length
 }

 stats.innerText = `
   Total Leads: ${data.length}
   Avg Intent Score: ${avg.toFixed(1)}
 `
}

loadStats()
</script>

</body>
</html>